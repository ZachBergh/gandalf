# This file is generated by pm-quesiton-dashboard
before_script:
  - PROJECT_CI_PATH=$PWD
  - REPO_PATH=git.curio.im/hacker/gandalf

build_and_test:
  script:
  - env
  only:
  - master

deploy_prod:
  script:
  - rm -rf $PROJECT_CI_PATH/.git
  - ssh root@salt-master-internal.curio.im "mkdir -p /mnt/sdc/gocode/src/$REPO_PATH"
  - rsync --delete -avz $PROJECT_CI_PATH/ root@salt-master-internal.curio.im:/mnt/sdc/gocode/src/$REPO_PATH
  - ssh root@salt-master-internal.curio.im "salt hk-qc-ap1-130-3-build-bot state.sls prod.gandalf.build"
  - ssh root@salt-master-internal.curio.im "salt cn-qc-gd1-9-17-crontab-server-1 state.sls prod.gandalf.publish"
  type: deploy
  only:
  - prod